Commits in this patch:
----------------------

  ad1e45359de9fcb7df15961991a94c965d8fa605
  dm verity: set DM_TARGET_IMMUTABLE feature flag



dm verity: set DM_TARGET_IMMUTABLE feature flag

jira: ROC-3188
cve: CVE-2022-2503
commit: 4caae58406f8ceb741603eee460d79bacca9b1b5

The device-mapper framework provides a mechanism to mark targets as
immutable (and hence fail table reloads that try to change the target
type). Add the DM_TARGET_IMMUTABLE flag to the dm-verity target's
feature flags to prevent switching the verity target with a different
target type.

    Fixes: a4ffc152198e ("dm: add verity target")
    Cc: stable@vger.kernel.org
    Signed-off-by: Sarthak Kukreti <sarthakkukreti@google.com>
    Reviewed-by: Kees Cook <keescook@chromium.org>
    Signed-off-by: Mike Snitzer <snitzer@kernel.org>
    (cherry picked from commit 4caae58406f8ceb741603eee460d79bacca9b1b5)

Signed-off-by: David Gomez <dgomez@ciq.com>
diff --git a/drivers/md/dm-verity-target.c b/drivers/md/dm-verity-target.c
index 245679d2bac6..8a54fcbb266b 100644
--- a/drivers/md/dm-verity-target.c
+++ b/drivers/md/dm-verity-target.c
@@ -1270,6 +1270,7 @@ static int verity_ctr(struct dm_target *ti, unsigned argc, char **argv)
 
 static struct target_type verity_target = {
 	.name		= "verity",
+	.features	= DM_TARGET_IMMUTABLE,
 	.version	= {1, 8, 0},
 	.module		= THIS_MODULE,
 	.ctr		= verity_ctr,
-- 
2.39.3

